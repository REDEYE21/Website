<link rel="stylesheet" href="styles.css">

<h2 id="CounterHeader">عدد الركع</h2>
<p id="counterValue">0 / 10,000</p>
<p id="counterRemaining">المتبقي: 10,000</p>
<button id="incBtn">+1</button>
<button id="decBtn">-1</button>

<script>
const MAX_COUNT = 10000;

// Fetch counter from server
async function fetchCounter() {
  const res = await fetch('/counter', {
    credentials: 'same-origin' // <-- send session cookie
  });
  if (!res.ok) {
    console.error('Failed to fetch counter', res.status);
    return;
  }
  const data = await res.json();
  updateCounterDisplay(data.counter);
}

// Update counter (+1 or -1)
async function updateCounter(action) {
  const res = await fetch('/counter', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ action }),
    credentials: 'same-origin' // <-- send session cookie
  });

  if (!res.ok) {
    console.error('Failed to update counter', res.status);
    return;
  }

  const data = await res.json();
  updateCounterDisplay(data.counter);
}

// Update display
function updateCounterDisplay(counter) {
  document.getElementById('counterValue').innerText = `${counter} / ${MAX_COUNT}`;
  const remaining = MAX_COUNT - counter;
  document.getElementById('counterRemaining').innerText = `المتبقي: ${remaining > 0 ? remaining : 0}`;
}

// Button listeners
document.getElementById('incBtn').addEventListener('click', () => updateCounter('increment'));
document.getElementById('decBtn').addEventListener('click', () => updateCounter('decrement'));

// Load initial value
fetchCounter();
</script>
